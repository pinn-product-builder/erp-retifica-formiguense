# US-ORC-008: Alertas de Or√ßamentos Pendentes

**ID:** US-ORC-008  
**Epic:** Or√ßamentos  
**Sprint:** 5  
**Prioridade:** M√©dia  
**Estimativa:** 3 pontos  
**Status:** Backlog  

---

## üìã User Story

**Como** gerente comercial  
**Quero** receber alertas sobre or√ßamentos pendentes de aprova√ß√£o  
**Para** acompanhar proativamente e evitar perda de vendas por esquecimento

---

## üéØ Business Objective

Criar sistema de alertas proativo para or√ßamentos que requerem aten√ß√£o, reduzindo tempo de resposta e melhorando convers√£o.

---

## üìê Business Rules

### RN050: Tipos de Alertas
```typescript
type AlertType =
  | 'pending_approval'        // Aguardando aprova√ß√£o cliente
  | 'expiring_soon'           // Vence em 3 dias
  | 'expired'                 // Validade vencida
  | 'no_response'             // Sem resposta > 7 dias
  | 'partial_pending'         // Parcial aguarda decis√£o
  | 'needs_revision';         // Cliente pediu revis√£o

interface BudgetAlert {
  id: string;
  budget_id: string;
  alert_type: AlertType;
  severity: 'low' | 'medium' | 'high' | 'critical';
  message: string;
  created_at: Date;
  acknowledged: boolean;      // Usu√°rio j√° viu?
  acknowledged_by?: string;
  acknowledged_at?: Date;
  expires_at?: Date;          // Alert expira quando?
}
```

### RN051: Crit√©rios de Gera√ß√£o
**Alertas autom√°ticos gerados quando:**

1. **Pending Approval (Severidade: M√©dia)**
   - Status: `pending_customer`
   - Condi√ß√£o: Enviado h√° mais de 2 dias
   - Mensagem: "Or√ßamento X aguarda resposta h√° Y dias"

2. **Expiring Soon (Severidade: Alta)**
   - Condi√ß√£o: `valid_until` em 3 dias ou menos
   - Status: `pending_customer` ou `draft`
   - Mensagem: "Or√ßamento X vence em Y dias"

3. **Expired (Severidade: Cr√≠tica)**
   - Condi√ß√£o: `valid_until` < hoje
   - Status: n√£o `approved` ou `rejected`
   - Mensagem: "Or√ßamento X venceu e precisa renova√ß√£o"

4. **No Response (Severidade: Alta)**
   - Condi√ß√£o: Enviado h√° mais de 7 dias sem resposta
   - Status: `pending_customer`
   - Mensagem: "Sem resposta do cliente h√° Y dias"

5. **Partial Pending (Severidade: M√©dia)**
   - Status: `partially_approved`
   - Condi√ß√£o: Aprova√ß√£o parcial h√° mais de 2 dias
   - Mensagem: "Aprova√ß√£o parcial aguarda a√ß√£o"

### RN052: Dashboard de Alertas
**Localiza√ß√£o:**
- Widget no Dashboard principal
- Badge de notifica√ß√£o no menu Or√ßamentos
- Centro de notifica√ß√µes global

**Informa√ß√µes exibidas:**
```typescript
interface AlertDashboard {
  critical_count: number;        // Alertas cr√≠ticos
  high_count: number;            // Alertas altos
  total_pending: number;         // Total pendente
  oldest_alert_days: number;     // Alerta mais antigo
  alerts_by_type: Record<AlertType, number>;
  recent_alerts: BudgetAlert[];  // √öltimos 5
}
```

### RN053: A√ß√µes Dispon√≠veis
**Usu√°rio pode:**
- ‚úÖ Marcar alerta como "Visto"
- üìû Ligar para cliente (se integrado)
- üì± Enviar WhatsApp/Email lembrete
- üîÑ Renovar validade do or√ßamento
- ‚úèÔ∏è Revisar or√ßamento
- ‚ùå Arquivar or√ßamento

### RN054: Frequ√™ncia de Verifica√ß√£o
**Job autom√°tico:**
```sql
-- Executa diariamente √†s 8h
-- Verifica todos os or√ßamentos e gera alertas necess√°rios
-- Remove alertas expirados ou n√£o mais aplic√°veis
```

### RN055: Notifica√ß√µes
**Al√©m dos alertas no sistema:**
- **Email di√°rio (resumo):** Para gerentes com alertas cr√≠ticos
- **Push notification:** Para alertas cr√≠ticos em tempo real
- **Resumo semanal:** Relat√≥rio de or√ßamentos n√£o conclu√≠dos

---

## ‚úÖ Acceptance Criteria

**AC52:** Widget de alertas aparece no dashboard  
**AC53:** Badge num√©rico mostra quantidade de alertas cr√≠ticos  
**AC54:** Alertas s√£o categorizados por severidade  
**AC55:** Job autom√°tico gera alertas diariamente  
**AC56:** Usu√°rio pode marcar alerta como visto  
**AC57:** Click no alerta abre detalhes do or√ßamento  
**AC58:** Centro de notifica√ß√µes lista todos os alertas  
**AC59:** Alertas expirados s√£o removidos automaticamente

---

## üõ†Ô∏è Definition of Done

- [ ] Tabela `budget_alerts` criada
- [ ] Job autom√°tico de gera√ß√£o de alertas implementado
- [ ] Componente `BudgetAlertsWidget.tsx` criado
- [ ] Componente `AlertCenter.tsx` implementado
- [ ] Hook `useBudgetAlerts.ts` criado
- [ ] L√≥gica de severidade implementada
- [ ] A√ß√µes de alerta funcionais
- [ ] Notifica√ß√µes por email configuradas
- [ ] Testes E2E escritos

---

## üìÅ Affected Components

```
src/components/budgets/
  ‚îú‚îÄ‚îÄ BudgetAlertsWidget.tsx       (NEW)
  ‚îî‚îÄ‚îÄ AlertCenter.tsx              (NEW)

src/components/dashboard/
  ‚îî‚îÄ‚îÄ DashboardOverview.tsx        (UPDATE - adicionar widget)

src/hooks/
  ‚îî‚îÄ‚îÄ useBudgetAlerts.ts           (NEW)

supabase/migrations/
  ‚îî‚îÄ‚îÄ YYYYMMDDHHMMSS_budget_alerts.sql  (NEW)
```

---

## üóÑÔ∏è Database Schema

```sql
-- Tabela de alertas de or√ßamentos
CREATE TABLE budget_alerts (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  budget_id UUID REFERENCES detailed_budgets(id) NOT NULL,
  alert_type TEXT NOT NULL CHECK (
    alert_type IN (
      'pending_approval', 'expiring_soon', 'expired',
      'no_response', 'partial_pending', 'needs_revision'
    )
  ),
  severity TEXT NOT NULL CHECK (
    severity IN ('low', 'medium', 'high', 'critical')
  ),
  message TEXT NOT NULL,
  
  -- Controle de visualiza√ß√£o
  acknowledged BOOLEAN DEFAULT false,
  acknowledged_by UUID REFERENCES profiles(id),
  acknowledged_at TIMESTAMPTZ,
  
  -- Expira√ß√£o do alerta
  expires_at TIMESTAMPTZ,
  
  created_at TIMESTAMPTZ DEFAULT now(),
  
  -- √çndice composto para busca r√°pida
  UNIQUE(budget_id, alert_type)
);

-- √çndices
CREATE INDEX idx_budget_alerts_budget ON budget_alerts(budget_id);
CREATE INDEX idx_budget_alerts_severity ON budget_alerts(severity);
CREATE INDEX idx_budget_alerts_acknowledged ON budget_alerts(acknowledged);

-- RLS
ALTER TABLE budget_alerts ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Users can view alerts of their org budgets"
  ON budget_alerts FOR SELECT
  USING (
    EXISTS (
      SELECT 1 FROM detailed_budgets db
      JOIN orders o ON o.id = db.order_id
      WHERE db.id = budget_alerts.budget_id
      AND o.org_id = (SELECT org_id FROM profiles WHERE id = auth.uid())
    )
  );

CREATE POLICY "Users can acknowledge alerts"
  ON budget_alerts FOR UPDATE
  USING (
    EXISTS (
      SELECT 1 FROM detailed_budgets db
      JOIN orders o ON o.id = db.order_id
      WHERE db.id = budget_alerts.budget_id
      AND o.org_id = (SELECT org_id FROM profiles WHERE id = auth.uid())
    )
  );

-- Fun√ß√£o para gerar alertas automaticamente
CREATE OR REPLACE FUNCTION generate_budget_alerts()
RETURNS void AS $$
DECLARE
  v_budget RECORD;
  v_days_since_sent INTEGER;
  v_days_until_expiry INTEGER;
  v_alert_type TEXT;
  v_severity TEXT;
  v_message TEXT;
  v_expires_at TIMESTAMPTZ;
BEGIN
  -- Limpar alertas antigos/irrelevantes
  DELETE FROM budget_alerts
  WHERE expires_at < NOW()
  OR budget_id IN (
    SELECT id FROM detailed_budgets
    WHERE status IN ('approved', 'rejected')
  );
  
  -- Iterar sobre or√ßamentos que precisam alerta
  FOR v_budget IN
    SELECT 
      db.id,
      db.budget_number,
      db.status,
      db.valid_until,
      db.created_at,
      db.updated_at,
      o.org_id,
      c.name AS customer_name,
      (SELECT sent_at FROM budget_send_logs 
       WHERE budget_id = db.id 
       ORDER BY sent_at DESC LIMIT 1) AS last_sent
    FROM detailed_budgets db
    JOIN orders o ON o.id = db.order_id
    JOIN customers c ON c.id = o.customer_id
    WHERE db.status NOT IN ('approved', 'rejected')
  LOOP
    -- Calcular dias desde envio
    IF v_budget.last_sent IS NOT NULL THEN
      v_days_since_sent := EXTRACT(DAY FROM NOW() - v_budget.last_sent);
    ELSE
      v_days_since_sent := NULL;
    END IF;
    
    -- Calcular dias at√© expira√ß√£o
    v_days_until_expiry := EXTRACT(DAY FROM v_budget.valid_until - CURRENT_DATE);
    
    -- Determinar tipo de alerta
    
    -- ALERTA 1: Or√ßamento vencido
    IF v_days_until_expiry < 0 AND v_budget.status != 'draft' THEN
      v_alert_type := 'expired';
      v_severity := 'critical';
      v_message := 'Or√ßamento ' || v_budget.budget_number || 
                   ' venceu h√° ' || ABS(v_days_until_expiry) || ' dias e precisa renova√ß√£o';
      v_expires_at := NULL;  -- N√£o expira at√© ser resolvido
      
      INSERT INTO budget_alerts (
        budget_id, alert_type, severity, message, expires_at
      ) VALUES (
        v_budget.id, v_alert_type, v_severity, v_message, v_expires_at
      )
      ON CONFLICT (budget_id, alert_type) 
      DO UPDATE SET 
        message = EXCLUDED.message,
        created_at = NOW();
    
    -- ALERTA 2: Vencendo em breve
    ELSIF v_days_until_expiry <= 3 AND v_days_until_expiry >= 0 THEN
      v_alert_type := 'expiring_soon';
      v_severity := 'high';
      v_message := 'Or√ßamento ' || v_budget.budget_number || 
                   ' vence em ' || v_days_until_expiry || ' dias';
      v_expires_at := v_budget.valid_until;
      
      INSERT INTO budget_alerts (
        budget_id, alert_type, severity, message, expires_at
      ) VALUES (
        v_budget.id, v_alert_type, v_severity, v_message, v_expires_at
      )
      ON CONFLICT (budget_id, alert_type) 
      DO UPDATE SET 
        message = EXCLUDED.message,
        created_at = NOW();
    
    -- ALERTA 3: Sem resposta h√° muito tempo
    ELSIF v_days_since_sent >= 7 AND v_budget.status = 'pending_customer' THEN
      v_alert_type := 'no_response';
      v_severity := 'high';
      v_message := 'Or√ßamento ' || v_budget.budget_number || 
                   ' enviado para ' || v_budget.customer_name ||
                   ' h√° ' || v_days_since_sent || ' dias sem resposta';
      v_expires_at := v_budget.valid_until;
      
      INSERT INTO budget_alerts (
        budget_id, alert_type, severity, message, expires_at
      ) VALUES (
        v_budget.id, v_alert_type, v_severity, v_message, v_expires_at
      )
      ON CONFLICT (budget_id, alert_type) 
      DO UPDATE SET 
        message = EXCLUDED.message,
        created_at = NOW();
    
    -- ALERTA 4: Pendente h√° 2+ dias
    ELSIF v_days_since_sent >= 2 AND v_budget.status = 'pending_customer' THEN
      v_alert_type := 'pending_approval';
      v_severity := 'medium';
      v_message := 'Or√ßamento ' || v_budget.budget_number || 
                   ' aguarda resposta h√° ' || v_days_since_sent || ' dias';
      v_expires_at := v_budget.valid_until;
      
      INSERT INTO budget_alerts (
        budget_id, alert_type, severity, message, expires_at
      ) VALUES (
        v_budget.id, v_alert_type, v_severity, v_message, v_expires_at
      )
      ON CONFLICT (budget_id, alert_type) 
      DO UPDATE SET 
        message = EXCLUDED.message;
    
    -- ALERTA 5: Aprova√ß√£o parcial pendente
    ELSIF v_budget.status = 'partially_approved' THEN
      v_alert_type := 'partial_pending';
      v_severity := 'medium';
      v_message := 'Or√ßamento ' || v_budget.budget_number || 
                   ' com aprova√ß√£o parcial aguarda a√ß√£o';
      v_expires_at := v_budget.valid_until;
      
      INSERT INTO budget_alerts (
        budget_id, alert_type, severity, message, expires_at
      ) VALUES (
        v_budget.id, v_alert_type, v_severity, v_message, v_expires_at
      )
      ON CONFLICT (budget_id, alert_type) 
      DO UPDATE SET 
        message = EXCLUDED.message;
    END IF;
    
  END LOOP;
  
  RAISE NOTICE 'Alertas de or√ßamentos atualizados com sucesso';
END;
$$ LANGUAGE plpgsql;

-- Fun√ß√£o para marcar alerta como visto
CREATE OR REPLACE FUNCTION acknowledge_budget_alert(
  p_alert_id UUID
) RETURNS void AS $$
BEGIN
  UPDATE budget_alerts
  SET 
    acknowledged = true,
    acknowledged_by = auth.uid(),
    acknowledged_at = NOW()
  WHERE id = p_alert_id;
END;
$$ LANGUAGE plpgsql SECURITY DEFINER;

-- View para dashboard de alertas
CREATE OR REPLACE VIEW budget_alerts_dashboard AS
SELECT 
  o.org_id,
  COUNT(*) AS total_alerts,
  COUNT(*) FILTER (WHERE ba.severity = 'critical') AS critical_count,
  COUNT(*) FILTER (WHERE ba.severity = 'high') AS high_count,
  COUNT(*) FILTER (WHERE ba.severity = 'medium') AS medium_count,
  COUNT(*) FILTER (WHERE ba.severity = 'low') AS low_count,
  COUNT(*) FILTER (WHERE ba.acknowledged = false) AS unacknowledged_count,
  MAX(EXTRACT(DAY FROM NOW() - ba.created_at)) AS oldest_alert_days
FROM budget_alerts ba
JOIN detailed_budgets db ON db.id = ba.budget_id
JOIN orders o ON o.id = db.order_id
WHERE ba.acknowledged = false
GROUP BY o.org_id;

-- Permiss√µes
GRANT SELECT ON budget_alerts_dashboard TO authenticated;

-- Agendar execu√ß√£o di√°ria (via pg_cron se dispon√≠vel)
-- SELECT cron.schedule(
--   'generate-budget-alerts',
--   '0 8 * * *',  -- Todo dia √†s 8h
--   $$ SELECT generate_budget_alerts(); $$
-- );
```

---

## üé® Wireframe

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  üìä Dashboard                                                 ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                               ‚îÇ
‚îÇ  ‚îå‚îÄ ALERTAS DE OR√áAMENTOS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ                                                [üîî 5]   ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚ö†Ô∏è ALERTAS CR√çTICOS (2)                                ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ üî¥ Or√ßamento ORC-2025-0012-BLOCO venceu h√° 5 dias ‚îÇ  ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ    Cliente: XYZ Motors | Valor: R$ 2.850         ‚îÇ  ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ    [Renovar Validade] [Abrir Or√ßamento]          ‚îÇ  ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§  ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ üî¥ Or√ßamento ORC-2025-0008-CABECOTE venceu       ‚îÇ  ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ    Cliente: ABC Ltda | Valor: R$ 1.120           ‚îÇ  ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ    [Renovar Validade] [Abrir Or√ßamento]          ‚îÇ  ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ                                                          ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚ö†Ô∏è ALERTAS IMPORTANTES (3)                              ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ üü† Sem resposta h√° 9 dias - ORC-2025-0015        ‚îÇ  ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ    [Enviar Lembrete] [‚úì Marcar como Visto]       ‚îÇ  ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§  ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ üü† Vence em 2 dias - ORC-2025-0018               ‚îÇ  ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ    [Revisar] [‚úì Marcar como Visto]               ‚îÇ  ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§  ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ üü† Aprova√ß√£o parcial pendente - ORC-2025-0010    ‚îÇ  ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ    [Abrir] [‚úì Marcar como Visto]                 ‚îÇ  ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ                                                          ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  [Ver Todos os Alertas (8) ‚Üí]                           ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                                                               ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  üîî Centro de Notifica√ß√µes - Or√ßamentos                      ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                               ‚îÇ
‚îÇ  Filtros: [Todos ‚ñº] [Cr√≠ticos] [Importantes] [N√£o Vistos]   ‚îÇ
‚îÇ                                            [‚úì Marcar Todos]  ‚îÇ
‚îÇ                                                               ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ üî¥ CR√çTICO | h√° 5 dias                                  ‚îÇ ‚îÇ
‚îÇ  ‚îÇ Or√ßamento ORC-2025-0012-BLOCO venceu h√° 5 dias         ‚îÇ ‚îÇ
‚îÇ  ‚îÇ Cliente: XYZ Motors | Valor: R$ 2.850                   ‚îÇ ‚îÇ
‚îÇ  ‚îÇ A√ß√µes: [Renovar] [Revisar] [Arquivar] [‚úì Visto]        ‚îÇ ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§ ‚îÇ
‚îÇ  ‚îÇ üü† ALTO | h√° 2 dias                                     ‚îÇ ‚îÇ
‚îÇ  ‚îÇ Sem resposta h√° 9 dias - ORC-2025-0015-BIELA           ‚îÇ ‚îÇ
‚îÇ  ‚îÇ Cliente: ABC Ltda | Enviado: 18/01/2025                ‚îÇ ‚îÇ
‚îÇ  ‚îÇ A√ß√µes: [WhatsApp] [Email] [Ligar] [‚úì Visto]            ‚îÇ ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§ ‚îÇ
‚îÇ  ‚îÇ üü† ALTO | h√° 1 dia                                      ‚îÇ ‚îÇ
‚îÇ  ‚îÇ Vence em 2 dias - ORC-2025-0018-VIRABREQUIM            ‚îÇ ‚îÇ
‚îÇ  ‚îÇ Cliente: Motor Service | Valor: R$ 1.450                ‚îÇ ‚îÇ
‚îÇ  ‚îÇ A√ß√µes: [Renovar] [Revisar] [Enviar Lembrete] [‚úì Visto] ‚îÇ ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§ ‚îÇ
‚îÇ  ‚îÇ üü° M√âDIO | h√° 3 horas                                   ‚îÇ ‚îÇ
‚îÇ  ‚îÇ Aprova√ß√£o parcial pendente - ORC-2025-0010-PISTAO      ‚îÇ ‚îÇ
‚îÇ  ‚îÇ Cliente: Auto Parts | Itens: 2 de 5 aprovados           ‚îÇ ‚îÇ
‚îÇ  ‚îÇ A√ß√µes: [Ver Detalhes] [Criar Novo Or√ßamento] [‚úì Visto] ‚îÇ ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§ ‚îÇ
‚îÇ  ‚îÇ üü° M√âDIO | h√° 2 dias                                    ‚îÇ ‚îÇ
‚îÇ  ‚îÇ Pendente aprova√ß√£o h√° 3 dias - ORC-2025-0020            ‚îÇ ‚îÇ
‚îÇ  ‚îÇ Cliente: Diesel Tech | Valor: R$ 890                    ‚îÇ ‚îÇ
‚îÇ  ‚îÇ A√ß√µes: [Enviar Lembrete] [‚úì Visto]                     ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ                                                               ‚îÇ
‚îÇ  Mostrando 5 de 8 alertas  [Carregar mais]                   ‚îÇ
‚îÇ                                                               ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üß™ Test Scenarios

### E2E Test 1: Gerar Alertas Automaticamente
```gherkin
Given que existem or√ßamentos com condi√ß√µes de alerta
When job "generate_budget_alerts()" √© executado
Then alertas s√£o criados para:
  - Or√ßamentos vencidos (cr√≠tico)
  - Vencendo em 3 dias (alto)
  - Sem resposta h√° 7+ dias (alto)
  - Pendentes h√° 2+ dias (m√©dio)
And alertas antigos/irrelevantes s√£o removidos
```

### E2E Test 2: Visualizar Widget no Dashboard
```gherkin
Given que tenho 5 alertas n√£o vistos
When acesso Dashboard
Then widget "Alertas de Or√ßamentos" aparece
And mostra badge com n√∫mero "5"
And lista 2 alertas cr√≠ticos no topo
And lista 3 alertas importantes
And bot√£o "Ver Todos" est√° dispon√≠vel
```

### E2E Test 3: Marcar Alerta como Visto
```gherkin
Given que visualizo alerta de or√ßamento vencido
When clico em "‚úì Marcar como Visto"
Then alerta √© marcado como "acknowledged"
And badge de notifica√ß√µes diminui -1
And alerta permanece vis√≠vel mas com indicador "visto"
```

### E2E Test 4: A√ß√£o R√°pida - Renovar Validade
```gherkin
Given que tenho alerta "Or√ßamento vencido"
When clico em "Renovar Validade"
Then modal abre com:
  - Nova data de validade pr√©-preenchida (+30 dias)
  - Op√ß√£o de notificar cliente
When confirmo renova√ß√£o
Then valid_until √© atualizado
And alerta "expired" √© removido
And cliente recebe notifica√ß√£o (se marcado)
```

### E2E Test 5: Centro de Notifica√ß√µes
```gherkin
Given que tenho 8 alertas de v√°rios tipos
When clico no √≠cone de notifica√ß√µes
Then modal "Centro de Notifica√ß√µes" abre
And alertas s√£o listados por severidade
And filtros permitem segmentar por tipo/severidade
And a√ß√µes r√°pidas est√£o dispon√≠veis para cada alerta
```

### E2E Test 6: Email Di√°rio de Resumo
```gherkin
Given que tenho alertas cr√≠ticos n√£o resolvidos
When job di√°rio de email executa
Then gerente recebe email com:
  - Assunto: "Alertas Cr√≠ticos de Or√ßamentos"
  - Lista de alertas cr√≠ticos
  - Link direto para cada or√ßamento
  - Resumo de alertas por severidade
```

### E2E Test 7: Remover Alertas Resolvidos
```gherkin
Given que tenho alerta "Or√ßamento vencido"
When aprovo o or√ßamento
Then status muda para "approved"
And job de limpeza remove alerta automaticamente
And alerta n√£o aparece mais no dashboard
```

---

## üö´ Negative Scope

**N√£o inclui:**
- Alertas personaliz√°veis por usu√°rio
- Notifica√ß√µes push mobile
- Integra√ß√£o com Slack/Teams
- Alertas de or√ßamento em andamento (apenas pendentes)
- Snooze de alertas (adiar)

---

## üîó Dependencies

**Blocks:**
- Nenhuma

**Blocked by:**
- US-ORC-001 a US-ORC-006 (funcionalidades base)

**Related:**
- US-NOT-001 (Sistema de Notifica√ß√µes Globais)

---

**√öltima atualiza√ß√£o:** 2025-01-27  
**Vers√£o:** 1.0
