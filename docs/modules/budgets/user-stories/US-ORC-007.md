# US-ORC-007: Relat√≥rios de Or√ßamentos

**ID:** US-ORC-007  
**Epic:** Or√ßamentos  
**Sprint:** 5  
**Prioridade:** M√©dia  
**Estimativa:** 5 pontos  
**Status:** Backlog  

---

## üìã User Story

**Como** gerente comercial  
**Quero** visualizar relat√≥rios anal√≠ticos de or√ßamentos  
**Para** acompanhar taxa de convers√£o, valores e desempenho comercial

---

## üéØ Business Objective

Fornecer insights sobre desempenho de or√ßamentos, identificando padr√µes de aprova√ß√£o, rejei√ß√£o e oportunidades de melhoria no processo comercial.

---

## üìê Business Rules

### RN043: Tipos de Relat√≥rios
```typescript
type ReportType =
  | 'conversion_funnel'     // Funil de convers√£o
  | 'by_status'             // Por status
  | 'by_component'          // Por componente
  | 'by_customer'           // Por cliente
  | 'by_period'             // Evolu√ß√£o temporal
  | 'rejection_analysis'    // An√°lise de rejei√ß√µes
  | 'average_values';       // Valores m√©dios
```

### RN044: M√©tricas Principais
```typescript
interface BudgetMetrics {
  // Contadores
  total_budgets: number;
  drafts: number;
  sent: number;
  approved: number;
  partially_approved: number;
  rejected: number;
  
  // Taxa de convers√£o
  conversion_rate: number;          // approved / sent * 100
  partial_conversion_rate: number;  // partially_approved / sent * 100
  rejection_rate: number;           // rejected / sent * 100
  
  // Valores
  total_value: number;              // Soma de todos or√ßamentos
  approved_value: number;           // Soma dos aprovados
  rejected_value: number;           // Soma dos rejeitados
  average_budget_value: number;     // M√©dia por or√ßamento
  average_approval_time: number;    // Tempo m√©dio at√© aprova√ß√£o (dias)
  
  // Componentes
  most_quoted_component: string;
  highest_approval_component: string;
  
  // Temporal
  budgets_by_month: Record<string, number>;
  approval_trend: 'increasing' | 'stable' | 'decreasing';
}
```

### RN045: Filtros Dispon√≠veis
```typescript
interface ReportFilters {
  date_range: {
    start_date: Date;
    end_date: Date;
  };
  status?: BudgetStatus[];
  component?: ComponentType[];
  customer_id?: string;
  created_by?: string;
  min_value?: number;
  max_value?: number;
  approval_method?: ApprovalMethod[];
}
```

### RN046: Funil de Convers√£o
**Visualiza√ß√£o em cascata:**
```
Rascunhos (draft)              100 or√ßamentos (100%)
    ‚Üì
Enviados (pending_customer)     85 or√ßamentos ( 85%)
    ‚Üì
Aprovados parcial/total         68 or√ßamentos ( 68%)
    ‚Üì  
Finalizados (approved)          65 or√ßamentos ( 65%)
```

**Taxas calculadas:**
- Taxa de envio: `sent / drafts * 100`
- Taxa de convers√£o: `approved / sent * 100`
- Taxa de abandono: `drafts_not_sent / drafts * 100`

### RN047: An√°lise de Rejei√ß√µes
**Categoriza√ß√£o de motivos:**
```typescript
interface RejectionAnalysis {
  total_rejections: number;
  reasons: {
    category: string;          // Ex: "Pre√ßo alto", "Prazo longo"
    count: number;
    percentage: number;
    average_value: number;     // Valor m√©dio rejeitado nesta categoria
  }[];
  most_common_reason: string;
  suggestions: string[];       // Sugest√µes de melhoria
}
```

### RN048: Comparativo por Componente
**Tabela de desempenho:**
```
Componente    | Qtd | Aprovados | Taxa | Valor M√©dio | Tempo M√©dio
Bloco         |  45 |    38     | 84%  |  R$ 2.850   |  3.2 dias
Cabe√ßote      |  32 |    28     | 88%  |  R$ 1.120   |  2.8 dias
Virabrequim   |  28 |    20     | 71%  |  R$ 1.450   |  4.1 dias
Biela         |  19 |    15     | 79%  |    R$ 890   |  3.5 dias
```

### RN049: Exporta√ß√£o
**Formatos suportados:**
- **PDF:** Relat√≥rio formatado com gr√°ficos
- **Excel:** Dados tabulares para an√°lise
- **CSV:** Dados brutos para importa√ß√£o

---

## ‚úÖ Acceptance Criteria

**AC45:** Dashboard mostra m√©tricas principais em cards  
**AC46:** Gr√°fico de funil de convers√£o √© exibido  
**AC47:** Filtros permitem segmentar por per√≠odo, status, componente  
**AC48:** Tabela de or√ßamentos detalhada √© gerada  
**AC49:** An√°lise de rejei√ß√µes identifica padr√µes  
**AC50:** Relat√≥rios podem ser exportados em PDF/Excel  
**AC51:** Gr√°ficos interativos permitem drill-down

---

## üõ†Ô∏è Definition of Done

- [ ] Componente `BudgetReports.tsx` implementado
- [ ] Hook `useBudgetReports.ts` criado
- [ ] Gr√°ficos de funil implementados
- [ ] An√°lise de rejei√ß√µes funcional
- [ ] Filtros din√¢micos operacionais
- [ ] Exporta√ß√£o PDF implementada
- [ ] Exporta√ß√£o Excel/CSV implementada
- [ ] View `budget_metrics` criada
- [ ] Testes E2E escritos

---

## üìÅ Affected Components

```
src/components/budgets/
  ‚îú‚îÄ‚îÄ BudgetReports.tsx            (NEW)
  ‚îú‚îÄ‚îÄ ConversionFunnelChart.tsx    (NEW)
  ‚îú‚îÄ‚îÄ ComponentPerformanceTable.tsx(NEW)
  ‚îî‚îÄ‚îÄ RejectionAnalysis.tsx        (NEW)

src/hooks/
  ‚îî‚îÄ‚îÄ useBudgetReports.ts          (NEW)

src/lib/
  ‚îú‚îÄ‚îÄ reportGenerator.ts           (NEW)
  ‚îî‚îÄ‚îÄ chartHelpers.ts              (NEW)
```

---

## üóÑÔ∏è Database Schema

```sql
-- View para m√©tricas agregadas de or√ßamentos
CREATE OR REPLACE VIEW budget_metrics AS
SELECT 
  org_id,
  
  -- Contadores
  COUNT(*) AS total_budgets,
  COUNT(*) FILTER (WHERE status = 'draft') AS drafts,
  COUNT(*) FILTER (WHERE status = 'pending_customer') AS sent,
  COUNT(*) FILTER (WHERE status = 'approved') AS approved,
  COUNT(*) FILTER (WHERE status = 'partially_approved') AS partially_approved,
  COUNT(*) FILTER (WHERE status = 'rejected') AS rejected,
  
  -- Taxas de convers√£o
  ROUND(
    COUNT(*) FILTER (WHERE status = 'approved')::NUMERIC / 
    NULLIF(COUNT(*) FILTER (WHERE status = 'pending_customer'), 0) * 100,
    2
  ) AS conversion_rate,
  
  ROUND(
    COUNT(*) FILTER (WHERE status = 'rejected')::NUMERIC / 
    NULLIF(COUNT(*) FILTER (WHERE status = 'pending_customer'), 0) * 100,
    2
  ) AS rejection_rate,
  
  -- Valores
  SUM(total) AS total_value,
  SUM(total) FILTER (WHERE status = 'approved') AS approved_value,
  SUM(total) FILTER (WHERE status = 'rejected') AS rejected_value,
  ROUND(AVG(total), 2) AS average_budget_value,
  
  -- Tempo m√©dio at√© aprova√ß√£o (em dias)
  ROUND(
    AVG(
      EXTRACT(EPOCH FROM (
        (SELECT approved_at FROM budget_approvals ba 
         WHERE ba.budget_id = db.id 
         ORDER BY approved_at DESC LIMIT 1) - db.created_at
      )) / 86400
    ) FILTER (WHERE status IN ('approved', 'customer_approved')),
    1
  ) AS average_approval_time_days

FROM detailed_budgets db
JOIN orders o ON o.id = db.order_id
GROUP BY org_id;

-- View para an√°lise por componente
CREATE OR REPLACE VIEW budget_by_component AS
SELECT 
  o.org_id,
  db.component,
  COUNT(*) AS total_count,
  COUNT(*) FILTER (WHERE db.status = 'approved') AS approved_count,
  ROUND(
    COUNT(*) FILTER (WHERE db.status = 'approved')::NUMERIC / 
    COUNT(*) * 100,
    1
  ) AS approval_rate,
  ROUND(AVG(db.total), 2) AS average_value,
  ROUND(
    AVG(
      EXTRACT(EPOCH FROM (
        (SELECT approved_at FROM budget_approvals ba 
         WHERE ba.budget_id = db.id 
         ORDER BY approved_at DESC LIMIT 1) - db.created_at
      )) / 86400
    ) FILTER (WHERE db.status IN ('approved', 'customer_approved')),
    1
  ) AS average_approval_days
FROM detailed_budgets db
JOIN orders o ON o.id = db.order_id
GROUP BY o.org_id, db.component;

-- View para evolu√ß√£o temporal
CREATE OR REPLACE VIEW budget_by_month AS
SELECT 
  o.org_id,
  DATE_TRUNC('month', db.created_at) AS month,
  COUNT(*) AS total_budgets,
  COUNT(*) FILTER (WHERE db.status = 'approved') AS approved_budgets,
  SUM(db.total) AS total_value,
  SUM(db.total) FILTER (WHERE db.status = 'approved') AS approved_value
FROM detailed_budgets db
JOIN orders o ON o.id = db.order_id
GROUP BY o.org_id, DATE_TRUNC('month', db.created_at)
ORDER BY month DESC;

-- View para an√°lise de rejei√ß√µes
CREATE OR REPLACE VIEW budget_rejections_analysis AS
SELECT 
  o.org_id,
  ba.rejection_reason,
  COUNT(*) AS rejection_count,
  ROUND(AVG(db.total), 2) AS average_rejected_value,
  ARRAY_AGG(db.component) AS rejected_components
FROM budget_approvals ba
JOIN detailed_budgets db ON db.id = ba.budget_id
JOIN orders o ON o.id = db.order_id
WHERE ba.approval_type = 'rejected'
GROUP BY o.org_id, ba.rejection_reason;

-- Fun√ß√£o para gerar relat√≥rio de funil
CREATE OR REPLACE FUNCTION get_budget_funnel(
  p_org_id UUID,
  p_start_date DATE DEFAULT NULL,
  p_end_date DATE DEFAULT NULL
) RETURNS TABLE (
  stage TEXT,
  count BIGINT,
  percentage NUMERIC
) AS $$
BEGIN
  RETURN QUERY
  WITH funnel_data AS (
    SELECT 
      CASE 
        WHEN status = 'draft' THEN 1
        WHEN status = 'pending_customer' THEN 2
        WHEN status IN ('customer_approved', 'partially_approved') THEN 3
        WHEN status = 'approved' THEN 4
        ELSE 0
      END AS stage_order,
      CASE 
        WHEN status = 'draft' THEN 'Rascunhos'
        WHEN status = 'pending_customer' THEN 'Enviados'
        WHEN status IN ('customer_approved', 'partially_approved') THEN 'Em Aprova√ß√£o'
        WHEN status = 'approved' THEN 'Finalizados'
        ELSE 'Outros'
      END AS stage_name,
      COUNT(*) AS stage_count
    FROM detailed_budgets db
    JOIN orders o ON o.id = db.order_id
    WHERE o.org_id = p_org_id
    AND (p_start_date IS NULL OR db.created_at::DATE >= p_start_date)
    AND (p_end_date IS NULL OR db.created_at::DATE <= p_end_date)
    GROUP BY stage_order, stage_name
  ),
  total_base AS (
    SELECT MAX(stage_count) AS base_count
    FROM funnel_data
    WHERE stage_order = 1
  )
  SELECT 
    fd.stage_name,
    fd.stage_count,
    ROUND((fd.stage_count::NUMERIC / tb.base_count * 100), 1)
  FROM funnel_data fd
  CROSS JOIN total_base tb
  WHERE fd.stage_order > 0
  ORDER BY fd.stage_order;
END;
$$ LANGUAGE plpgsql;

-- Permiss√µes
GRANT SELECT ON budget_metrics TO authenticated;
GRANT SELECT ON budget_by_component TO authenticated;
GRANT SELECT ON budget_by_month TO authenticated;
GRANT SELECT ON budget_rejections_analysis TO authenticated;
```

---

## üé® Wireframe

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  üìä Relat√≥rios de Or√ßamentos                                 ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                               ‚îÇ
‚îÇ  Filtros:                                                     ‚îÇ
‚îÇ  Per√≠odo: [üìÖ 01/01/2025] a [üìÖ 31/01/2025]                 ‚îÇ
‚îÇ  Status: [Todos ‚ñº]  Componente: [Todos ‚ñº]                   ‚îÇ
‚îÇ                    [üîç Aplicar Filtros]  [üì• Exportar PDF]  ‚îÇ
‚îÇ                                                               ‚îÇ
‚îÇ  ‚îå‚îÄ M√âTRICAS PRINCIPAIS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê‚îÇ
‚îÇ  ‚îÇ                                                          ‚îÇ‚îÇ
‚îÇ  ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê        ‚îÇ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ Total      ‚îÇ  ‚îÇ Aprovados  ‚îÇ  ‚îÇ Convers√£o  ‚îÇ        ‚îÇ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ 127        ‚îÇ  ‚îÇ 89         ‚îÇ  ‚îÇ 70.1%      ‚îÇ        ‚îÇ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ or√ßamentos ‚îÇ  ‚îÇ or√ßamentos ‚îÇ  ‚îÇ ‚ñ≤ +5.2%    ‚îÇ        ‚îÇ‚îÇ
‚îÇ  ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò        ‚îÇ‚îÇ
‚îÇ  ‚îÇ                                                          ‚îÇ‚îÇ
‚îÇ  ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê        ‚îÇ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ Rejeitados ‚îÇ  ‚îÇ Valor M√©dio‚îÇ  ‚îÇ Tempo M√©dio‚îÇ        ‚îÇ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ 18         ‚îÇ  ‚îÇ R$ 1.245   ‚îÇ  ‚îÇ 3.5 dias   ‚îÇ        ‚îÇ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ or√ßamentos ‚îÇ  ‚îÇ por or√ßam. ‚îÇ  ‚îÇ aprova√ß√£o  ‚îÇ        ‚îÇ‚îÇ
‚îÇ  ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò        ‚îÇ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò‚îÇ
‚îÇ                                                               ‚îÇ
‚îÇ  ‚îå‚îÄ FUNIL DE CONVERS√ÉO ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê‚îÇ
‚îÇ  ‚îÇ                                                          ‚îÇ‚îÇ
‚îÇ  ‚îÇ  Rascunhos              ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà  127 (100%)‚îÇ‚îÇ
‚îÇ  ‚îÇ                          ‚Üì 85%                           ‚îÇ‚îÇ
‚îÇ  ‚îÇ  Enviados               ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà      108 ( 85%)‚îÇ‚îÇ
‚îÇ  ‚îÇ                          ‚Üì 82%                           ‚îÇ‚îÇ
‚îÇ  ‚îÇ  Em Aprova√ß√£o           ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà        89 ( 70%)‚îÇ‚îÇ
‚îÇ  ‚îÇ                          ‚Üì 99%                           ‚îÇ‚îÇ
‚îÇ  ‚îÇ  Finalizados            ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà        88 ( 69%)‚îÇ‚îÇ
‚îÇ  ‚îÇ                                                          ‚îÇ‚îÇ
‚îÇ  ‚îÇ  Taxa de Convers√£o Final: 70.1%                          ‚îÇ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò‚îÇ
‚îÇ                                                               ‚îÇ
‚îÇ  ‚îå‚îÄ DESEMPENHO POR COMPONENTE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê‚îÇ
‚îÇ  ‚îÇ                                                          ‚îÇ‚îÇ
‚îÇ  ‚îÇ Componente   | Qtd | Aprov | Taxa | Valor M√©dio | Tempo ‚îÇ‚îÇ
‚îÇ  ‚îÇ Cabe√ßote     |  45 |   39  | 87%  |  R$ 1.120   | 2.8d  ‚îÇ‚îÇ
‚îÇ  ‚îÇ Bloco        |  38 |   32  | 84%  |  R$ 2.850   | 3.2d  ‚îÇ‚îÇ
‚îÇ  ‚îÇ Biela        |  19 |   15  | 79%  |    R$ 890   | 3.5d  ‚îÇ‚îÇ
‚îÇ  ‚îÇ Virabrequim  |  18 |   12  | 67%  |  R$ 1.450   | 4.1d  ‚îÇ‚îÇ
‚îÇ  ‚îÇ Pist√£o       |   7 |    6  | 86%  |    R$ 780   | 2.5d  ‚îÇ‚îÇ
‚îÇ  ‚îÇ                                                          ‚îÇ‚îÇ
‚îÇ  ‚îÇ üìä Melhor taxa: Cabe√ßote (87%)                           ‚îÇ‚îÇ
‚îÇ  ‚îÇ üí∞ Maior valor: Bloco (R$ 2.850)                         ‚îÇ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò‚îÇ
‚îÇ                                                               ‚îÇ
‚îÇ  ‚îå‚îÄ AN√ÅLISE DE REJEI√á√ïES (18 no per√≠odo) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê‚îÇ
‚îÇ  ‚îÇ                                                          ‚îÇ‚îÇ
‚îÇ  ‚îÇ Motivo              | Qtd |  %   | Valor M√©dio          ‚îÇ‚îÇ
‚îÇ  ‚îÇ Valor acima or√ßado  |   8 | 44%  | R$ 1.980             ‚îÇ‚îÇ
‚îÇ  ‚îÇ Prazo muito longo   |   5 | 28%  | R$ 1.120             ‚îÇ‚îÇ
‚îÇ  ‚îÇ Cliente desistiu    |   3 | 17%  |   R$ 890             ‚îÇ‚îÇ
‚îÇ  ‚îÇ Outros              |   2 | 11%  |   R$ 750             ‚îÇ‚îÇ
‚îÇ  ‚îÇ                                                          ‚îÇ‚îÇ
‚îÇ  ‚îÇ üí° Sugest√µes:                                            ‚îÇ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ Revisar precifica√ß√£o para valores acima de R$ 1.800   ‚îÇ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ Negociar prazos mais curtos com fornecedores          ‚îÇ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò‚îÇ
‚îÇ                                                               ‚îÇ
‚îÇ  ‚îå‚îÄ EVOLU√á√ÉO TEMPORAL ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê‚îÇ
‚îÇ  ‚îÇ                                                          ‚îÇ‚îÇ
‚îÇ  ‚îÇ  R$                                                      ‚îÇ‚îÇ
‚îÇ  ‚îÇ  30k ‚îÇ                                          ‚óè        ‚îÇ‚îÇ
‚îÇ  ‚îÇ  25k ‚îÇ                                 ‚óè        ‚îÇ        ‚îÇ‚îÇ
‚îÇ  ‚îÇ  20k ‚îÇ                        ‚óè        ‚îÇ        ‚îÇ        ‚îÇ‚îÇ
‚îÇ  ‚îÇ  15k ‚îÇ               ‚óè        ‚îÇ        ‚îÇ        ‚îÇ        ‚îÇ‚îÇ
‚îÇ  ‚îÇ  10k ‚îÇ      ‚óè        ‚îÇ        ‚îÇ        ‚îÇ        ‚îÇ        ‚îÇ‚îÇ
‚îÇ  ‚îÇ   5k ‚îÇ      ‚îÇ        ‚îÇ        ‚îÇ        ‚îÇ        ‚îÇ        ‚îÇ‚îÇ
‚îÇ  ‚îÇ      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ   ‚îÇ‚îÇ
‚îÇ  ‚îÇ      Set    Out     Nov      Dez      Jan                ‚îÇ‚îÇ
‚îÇ  ‚îÇ                                                          ‚îÇ‚îÇ
‚îÇ  ‚îÇ  Tend√™ncia: ‚ñ≤ Crescente (+15% vs m√™s anterior)          ‚îÇ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò‚îÇ
‚îÇ                                                               ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üß™ Test Scenarios

### E2E Test 1: Visualizar Dashboard de M√©tricas
```gherkin
Given que tenho or√ßamentos no sistema
When acesso "Relat√≥rios de Or√ßamentos"
Then vejo cards com m√©tricas principais:
  - Total de or√ßamentos
  - Taxa de convers√£o
  - Valor m√©dio
  - Tempo m√©dio de aprova√ß√£o
```

### E2E Test 2: Filtrar por Per√≠odo
```gherkin
Given que estou no dashboard de relat√≥rios
When seleciono per√≠odo "01/01/2025 a 31/01/2025"
And clico em "Aplicar Filtros"
Then todas as m√©tricas s√£o recalculadas
And mostram apenas dados do per√≠odo selecionado
```

### E2E Test 3: Visualizar Funil de Convers√£o
```gherkin
Given que apliquei filtros
When visualizo se√ß√£o "Funil de Convers√£o"
Then vejo gr√°fico em cascata mostrando:
  - Rascunhos (100%)
  - Enviados (X%)
  - Em Aprova√ß√£o (Y%)
  - Finalizados (Z%)
And taxa de convers√£o final √© exibida
```

### E2E Test 4: Analisar Desempenho por Componente
```gherkin
Given que tenho or√ßamentos de v√°rios componentes
When visualizo tabela "Desempenho por Componente"
Then vejo para cada componente:
  - Quantidade total
  - Quantidade aprovada
  - Taxa de aprova√ß√£o
  - Valor m√©dio
  - Tempo m√©dio
And componente com melhor taxa √© destacado
```

### E2E Test 5: An√°lise de Rejei√ß√µes
```gherkin
Given que tenho 18 or√ßamentos rejeitados
When visualizo "An√°lise de Rejei√ß√µes"
Then motivos s√£o categorizados e contados
And percentual de cada motivo √© exibido
And sugest√µes de melhoria s√£o apresentadas
```

### E2E Test 6: Exportar Relat√≥rio em PDF
```gherkin
Given que configurei filtros e visualizei relat√≥rios
When clico em "Exportar PDF"
Then PDF √© gerado com:
  - Cabe√ßalho com logo e data
  - M√©tricas principais
  - Gr√°ficos (funil, evolu√ß√£o)
  - Tabelas (componentes, rejei√ß√µes)
And download inicia automaticamente
```

### E2E Test 7: Drill-down em Componente
```gherkin
Given que visualizo tabela de componentes
When clico em "Bloco" (84% aprova√ß√£o)
Then modal/p√°gina abre com:
  - Lista de todos or√ßamentos de bloco
  - Status individual de cada um
  - Filtros adicionais
```

---

## üö´ Negative Scope

**N√£o inclui:**
- Comparativo entre per√≠odos (YoY, MoM)
- Previs√£o de vendas com IA
- An√°lise de margem de lucro
- Relat√≥rios personaliz√°veis (cria√ß√£o pelo usu√°rio)
- Dashboard em tempo real (auto-refresh)

---

## üîó Dependencies

**Blocks:**
- Nenhuma

**Blocked by:**
- US-ORC-001 a US-ORC-006 (dados completos)

**Related:**
- US-REL-001 (Sistema de Relat√≥rios Gerais)

---

**√öltima atualiza√ß√£o:** 2025-01-27  
**Vers√£o:** 1.0
