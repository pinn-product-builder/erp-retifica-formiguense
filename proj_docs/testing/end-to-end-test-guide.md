# üß™ Guia de Testes End-to-End - ERP Ret√≠fica Formiguense

## üìã Sum√°rio
1. [Prepara√ß√£o do Ambiente](#prepara√ß√£o-do-ambiente)
2. [Fluxos de Teste Principais](#fluxos-de-teste-principais)
3. [Cen√°rios de Teste Detalhados](#cen√°rios-de-teste-detalhados)
4. [Valida√ß√µes Cr√≠ticas](#valida√ß√µes-cr√≠ticas)
5. [Checklist de Testes](#checklist-de-testes)

---

## üîß Prepara√ß√£o do Ambiente

### **Pr√©-requisitos**
- [ ] Sistema rodando localmente ou em ambiente de staging
- [ ] Banco de dados Supabase configurado
- [ ] Migrations aplicadas
- [ ] Pelo menos 2 usu√°rios criados (admin e t√©cnico)
- [ ] Organiza√ß√£o configurada
- [ ] Tipos de motor cadastrados
- [ ] Status de workflow configurados

### **Dados de Teste Necess√°rios**
```sql
-- Cliente de teste
INSERT INTO customers (name, phone, email, document, org_id)
VALUES ('Cliente Teste', '11999999999', 'teste@email.com', '12345678900', '<org_id>');

-- Motor de teste
INSERT INTO engines (brand, model, type, serial_number, org_id)
VALUES ('Volkswagen', 'AP 1.6', 'gasolina', 'TEST123456', '<org_id>');

-- Pe√ßas de teste no estoque
INSERT INTO parts_inventory (part_code, part_name, quantity, unit_cost, org_id)
VALUES 
  ('PISTAO-050', 'Pist√£o 0.50mm', 10, 150.00, '<org_id>'),
  ('ANEL-STD', 'Jogo de An√©is STD', 5, 80.00, '<org_id>'),
  ('BRONZINA-BIELA', 'Bronzina de Biela', 3, 120.00, '<org_id>');

-- Configurar estoque m√≠nimo
INSERT INTO parts_stock_config (part_code, minimum_stock, reorder_point, auto_reorder_enabled, org_id)
VALUES 
  ('PISTAO-050', 10, 20, true, '<org_id>'),
  ('ANEL-STD', 15, 25, true, '<org_id>'),
  ('BRONZINA-BIELA', 10, 15, true, '<org_id>');
```

---

## üéØ Fluxos de Teste Principais

### **Fluxo 1: Cria√ß√£o de Ordem de Servi√ßo Completa**
**Objetivo**: Validar todo o ciclo desde cria√ß√£o at√© entrega

**Dura√ß√£o Estimada**: 30-45 minutos

**Passos**:
1. Login como **Atendente**
2. Criar nova OS
3. Preencher diagn√≥stico inicial
4. Gerar or√ßamento
5. Aprovar or√ßamento
6. Executar workflow (todas as etapas)
7. Finalizar e entregar OS

---

### **Fluxo 2: Gest√£o de Estoque e Compras**
**Objetivo**: Validar alertas, reservas e necessidades de compra

**Dura√ß√£o Estimada**: 20-30 minutos

**Passos**:
1. Verificar estoque inicial
2. Aprovar or√ßamento que consome pe√ßas
3. Validar reserva autom√°tica
4. Validar alertas de estoque baixo
5. Gerar necessidade de compra
6. Processar compra

---

### **Fluxo 3: Workflow com Checklists Obrigat√≥rios**
**Objetivo**: Validar bloqueios e valida√ß√µes de workflow

**Dura√ß√£o Estimada**: 15-20 minutos

**Passos**:
1. Iniciar etapa com checklist obrigat√≥rio
2. Tentar avan√ßar sem preencher
3. Validar bloqueio
4. Preencher checklist
5. Avan√ßar workflow
6. Validar relat√≥rio autom√°tico

---

## üìù Cen√°rios de Teste Detalhados

### **TESTE 01: Criar Ordem de Servi√ßo**

#### **Configura√ß√£o Inicial**
- **Usu√°rio**: Atendente ou Admin
- **Tela**: `/ordens`
- **Permiss√µes necess√°rias**: `operations.write`

#### **Passos Detalhados**

1. **Acessar m√≥dulo de Ordens**
   ```
   ‚úì Clicar em "Ordens de Servi√ßo" no menu lateral
   ‚úì Verificar se a lista de ordens √© exibida
   ‚úì Verificar filtros dispon√≠veis
   ```

2. **Criar Nova OS**
   ```
   ‚úì Clicar em "Nova Ordem"
   ‚úì Formul√°rio deve abrir (modal ou p√°gina)
   ‚úì Campos obrigat√≥rios marcados com *
   ```

3. **Preencher Dados do Cliente**
   ```
   ‚úì Buscar cliente existente ou criar novo
   ‚úì Campo de busca deve funcionar (autocomplete)
   ‚úì Validar CPF/CNPJ
   ‚úì Validar telefone (formato)
   ```

4. **Preencher Dados do Motor**
   ```
   ‚úì Selecionar tipo de motor
   ‚úì Componentes devem ser carregados automaticamente
   ‚úì Preencher marca, modelo, s√©rie
   ```

5. **Salvar Ordem**
   ```
   ‚úì Clicar em "Salvar"
   ‚úì Validar campos obrigat√≥rios
   ‚úì Toast de sucesso deve aparecer
   ‚úì Ordem deve aparecer na lista
   ‚úì Status inicial: "ativa"
   ```

#### **Valida√ß√µes Esperadas**
- ‚úÖ N√∫mero de ordem gerado automaticamente (formato: `OS-YYYY-XXXX`)
- ‚úÖ Data de cria√ß√£o = data atual
- ‚úÖ Workflows criados para cada componente do motor
- ‚úÖ Status inicial de cada workflow: "entrada"
- ‚úÖ Timeline com evento de cria√ß√£o
- ‚úÖ Notifica√ß√£o para t√©cnicos sobre nova OS

#### **Casos de Erro a Testar**
- ‚ùå Submeter formul√°rio sem cliente
- ‚ùå Submeter sem motor
- ‚ùå CPF/CNPJ inv√°lido
- ‚ùå Telefone em formato incorreto

---

### **TESTE 02: Check-in T√©cnico com Fotos**

#### **Configura√ß√£o Inicial**
- **Usu√°rio**: T√©cnico
- **Pr√©-requisito**: OS criada (TESTE 01)
- **Tela**: `/ordens/:id` (detalhes da ordem)

#### **Passos Detalhados**

1. **Acessar Detalhes da OS**
   ```
   ‚úì Encontrar OS na lista
   ‚úì Clicar para ver detalhes
   ‚úì Aba "Geral" deve estar ativa
   ```

2. **Realizar Check-in T√©cnico**
   ```
   ‚úì Verificar se h√° bot√£o "Check-in T√©cnico"
   ‚úì Clicar no bot√£o
   ‚úì Modal deve abrir com formul√°rio
   ```

3. **Upload de Fotos**
   ```
   ‚úì Clicar em "Adicionar Foto"
   ‚úì Selecionar imagem do computador
   ‚úì Preview da imagem deve aparecer
   ‚úì Adicionar descri√ß√£o (opcional)
   ‚úì Selecionar tipo de foto: "entrada"
   ‚úì Selecionar componente (bloco, biela, etc)
   ```

4. **Preencher Observa√ß√µes Iniciais**
   ```
   ‚úì Campo de texto livre
   ‚úì Suporta m√∫ltiplas linhas
   ‚úì M√°ximo de caracteres (validar)
   ```

5. **Confirmar Check-in**
   ```
   ‚úì Clicar em "Confirmar Check-in"
   ‚úì Loading durante upload
   ‚úì Toast de sucesso
   ‚úì Modal fecha automaticamente
   ```

#### **Valida√ß√µes Esperadas**
- ‚úÖ Fotos aparecem na aba "Fotos"
- ‚úÖ Cada foto tem:
  - URL assinada v√°lida (Supabase Storage)
  - Tipo correto (entrada)
  - Componente associado
  - Timestamp de upload
  - Uploader (nome do t√©cnico)
- ‚úÖ Timeline atualizada com evento de check-in
- ‚úÖ Workflows atualizados (se aplic√°vel)

#### **Casos de Erro a Testar**
- ‚ùå Upload de arquivo muito grande (>5MB)
- ‚ùå Upload de formato n√£o suportado (.exe, .zip)
- ‚ùå Sem conex√£o com internet durante upload
- ‚ùå Storage cheio (limite de quota)

---

### **TESTE 03: Diagn√≥stico com Checklist**

#### **Configura√ß√£o Inicial**
- **Usu√°rio**: T√©cnico
- **Pr√©-requisito**: Check-in realizado
- **Tela**: `/diagnosticos` ou detalhes da OS

#### **Passos Detalhados**

1. **Acessar M√≥dulo de Diagn√≥sticos**
   ```
   ‚úì Menu lateral > "Diagn√≥sticos"
   ‚úì OU aba "Diagn√≥stico" nos detalhes da OS
   ```

2. **Selecionar Componente para Diagn√≥stico**
   ```
   ‚úì Lista de componentes do motor
   ‚úì Cada componente com status
   ‚úì Clicar em "Diagnosticar" no componente desejado
   ```

3. **Preencher Checklist**
   ```
   ‚úì Checklist carregado com base no tipo de motor + componente
   ‚úì Itens agrupados por categoria
   ‚úì Cada item com:
     - Descri√ß√£o clara
     - Tipo de resposta (sim/n√£o, medi√ß√£o, texto)
     - Indicador de obrigatoriedade
   ```

4. **Itens do Checklist de Exemplo (Bloco)**
   ```
   INSPE√á√ÉO VISUAL
   ‚úì Trincas ou rachaduras? [Sim/N√£o] *
   ‚úì Desgaste excessivo? [Sim/N√£o] *
   ‚úì Corros√£o? [Sim/N√£o]
   
   MEDI√á√ïES
   ‚úì Di√¢metro do cilindro (mm): [___] * (range: 80-100)
   ‚úì Ovaliza√ß√£o (mm): [___] * (max: 0.05)
   ‚úì Conicidade (mm): [___] * (max: 0.03)
   
   OBSERVA√á√ïES
   ‚úì Notas adicionais: [texto livre]
   ```

5. **Adicionar Fotos ao Diagn√≥stico**
   ```
   ‚úì Bot√£o "Adicionar Foto" em cada se√ß√£o
   ‚úì Upload similar ao check-in
   ‚úì Associar foto a item espec√≠fico do checklist
   ```

6. **Definir Status Geral**
   ```
   ‚úì Sele√ß√£o de status:
     - ‚úÖ Aprovado (conforme)
     - ‚ö†Ô∏è Aprovado com ressalvas
     - ‚ùå Reprovado (n√£o conforme)
   ‚úì Status afeta workflow subsequente
   ```

7. **Salvar Diagn√≥stico**
   ```
   ‚úì Bot√£o "Salvar Diagn√≥stico"
   ‚úì Valida√ß√£o de campos obrigat√≥rios
   ‚úì Toast de sucesso
   ‚úì Redirect para lista/detalhes
   ```

#### **Valida√ß√µes Esperadas**
- ‚úÖ Diagn√≥stico salvo em `diagnostic_checklist_responses`
- ‚úÖ Responses JSONB com todas as respostas
- ‚úÖ Measurements JSONB com medi√ß√µes
- ‚úÖ Photos array com refer√™ncias das fotos
- ‚úÖ Timeline atualizada
- ‚úÖ **Notifica√ß√£o para gerente/admin sobre diagn√≥stico conclu√≠do**

#### **Casos de Erro a Testar**
- ‚ùå Salvar sem preencher campos obrigat√≥rios
- ‚ùå Medi√ß√£o fora do range permitido
- ‚ùå Formato de medi√ß√£o inv√°lido (texto em vez de n√∫mero)

---

### **TESTE 04: Gera√ß√£o de Or√ßamento**

#### **Configura√ß√£o Inicial**
- **Usu√°rio**: Atendente ou Admin
- **Pr√©-requisito**: Diagn√≥stico conclu√≠do
- **Tela**: `/orcamentos` ou detalhes da OS

#### **Passos Detalhados**

1. **Iniciar Or√ßamento**
   ```
   ‚úì Aba "Or√ßamento" na OS
   ‚úì OU lista de or√ßamentos pendentes
   ‚úì Clicar em "Gerar Or√ßamento"
   ```

2. **Adicionar Servi√ßos**
   ```
   ‚úì Bot√£o "Adicionar Servi√ßo"
   ‚úì Buscar servi√ßo (autocomplete)
   ‚úì Ou criar novo servi√ßo inline
   ‚úì Preencher:
     - Descri√ß√£o do servi√ßo
     - Quantidade (horas/unidades)
     - Valor unit√°rio
   ‚úì Valor total calculado automaticamente
   ```

3. **Adicionar Pe√ßas/Materiais**
   ```
   ‚úì Bot√£o "Adicionar Pe√ßa"
   ‚úì Buscar pe√ßa no estoque
   ‚úì Verificar disponibilidade em tempo real
   ‚úì Preencher:
     - C√≥digo da pe√ßa
     - Descri√ß√£o
     - Quantidade necess√°ria
     - Pre√ßo unit√°rio
   ‚úì Se indispon√≠vel: alerta visual
   ```

4. **C√°lculos Autom√°ticos**
   ```
   ‚úì Subtotal de servi√ßos
   ‚úì Subtotal de pe√ßas
   ‚úì Descontos (se aplic√°vel)
   ‚úì Total geral
   ‚úì Atualiza√ß√£o em tempo real
   ```

5. **Observa√ß√µes e Condi√ß√µes**
   ```
   ‚úì Prazo de execu√ß√£o estimado
   ‚úì Condi√ß√µes de pagamento
   ‚úì Garantia oferecida
   ‚úì Observa√ß√µes gerais
   ```

6. **Salvar Or√ßamento**
   ```
   ‚úì Bot√£o "Salvar Or√ßamento"
   ‚úì Valida√ß√£o de itens m√≠nimos
   ‚úì Toast de sucesso
   ‚úì Or√ßamento com status "draft" ou "pending"
   ```

#### **Valida√ß√µes Esperadas**
- ‚úÖ Or√ßamento salvo em `detailed_budgets`
- ‚úÖ Services JSONB com array de servi√ßos
- ‚úÖ Parts JSONB com array de pe√ßas
- ‚úÖ Total calculado corretamente
- ‚úÖ **Notifica√ß√£o para cliente (se e-mail cadastrado)**
- ‚úÖ **Alert criado em `budget_alerts` se n√£o aprovado em X dias**
- ‚úÖ Timeline atualizada

---

### **TESTE 05: Aprova√ß√£o de Or√ßamento (Trigger de Automa√ß√£o)**

#### **Configura√ß√£o Inicial**
- **Usu√°rio**: Cliente ou Admin (simulando aprova√ß√£o)
- **Pr√©-requisito**: Or√ßamento gerado
- **Tela**: `/orcamentos/:id`

#### **Passos Detalhados**

1. **Visualizar Or√ßamento**
   ```
   ‚úì Acesso via link enviado ao cliente
   ‚úì OU admin acessando pelo sistema
   ‚úì PDF do or√ßamento dispon√≠vel
   ‚úì Bot√µes de a√ß√£o vis√≠veis
   ```

2. **Aprovar Or√ßamento**
   ```
   ‚úì Bot√£o "Aprovar Or√ßamento"
   ‚úì Modal de confirma√ß√£o
   ‚úì M√©todo de aprova√ß√£o:
     - Digital (usu√°rio logado)
     - E-mail
     - WhatsApp
     - Presencial
   ‚úì Observa√ß√µes opcionais
   ‚úì Confirmar aprova√ß√£o
   ```

3. **Validar Automa√ß√µes Disparadas** ‚ö°

   **a) Reserva de Pe√ßas Autom√°tica**
   ```
   ‚úì Abrir `/estoque`
   ‚úì Buscar pe√ßas do or√ßamento
   ‚úì Verificar quantidade "Reservada"
   ‚úì Quantidade "Dispon√≠vel" deve diminuir
   ‚úì Tabela `parts_reservations` deve ter registros
   ```

   **b) Alertas de Estoque Baixo**
   ```
   ‚úì Se reserva deixou estoque < m√≠nimo:
     - Alerta criado em `stock_alerts`
     - N√≠vel do alerta (warning/critical)
     - Dashboard de alertas atualizado
     - Notifica√ß√£o enviada
   ```

   **c) Necessidades de Compra**
   ```
   ‚úì Se pe√ßa n√£o est√° em estoque ou insuficiente:
     - Registro em `purchase_needs`
     - Tipo: "planned" ou "emergency"
     - Prioridade calculada
     - Dashboard de compras atualizado
   ```

   **d) Contas a Receber**
   ```
   ‚úì Registro criado em `accounts_receivable`
   ‚úì Valor total do or√ßamento
   ‚úì Data de vencimento (conforme condi√ß√µes)
   ‚úì N√∫mero de parcelas (se parcelado)
   ‚úì Status: "pending"
   ```

   **e) Atualiza√ß√£o de Status da OS**
   ```
   ‚úì Status da ordem: "ativa" ‚Üí "aprovada"
   ‚úì Hist√≥rico de status atualizado
   ‚úì Timeline com evento de aprova√ß√£o
   ```

   **f) Notifica√ß√µes Disparadas**
   ```
   ‚úì Notifica√ß√£o para equipe de produ√ß√£o
   ‚úì Notifica√ß√£o de estoque baixo (se aplic√°vel)
   ‚úì Notifica√ß√£o de compra urgente (se aplic√°vel)
   ```

#### **Valida√ß√µes Esperadas (Checklist Completo)**
- ‚úÖ `budget_approvals` com registro de aprova√ß√£o
- ‚úÖ `parts_reservations` para cada pe√ßa do or√ßamento
- ‚úÖ `parts_inventory.quantity` reduzido corretamente
- ‚úÖ `stock_alerts` criado se estoque < m√≠nimo
- ‚úÖ `purchase_needs` criado para pe√ßas insuficientes
- ‚úÖ `accounts_receivable` criado com parcelas
- ‚úÖ `orders.status` = "aprovada"
- ‚úÖ `order_status_history` com mudan√ßa de status
- ‚úÖ `notifications` para stakeholders relevantes
- ‚úÖ **Dashboard de alertas atualizado em tempo real**

---

### **TESTE 06: Workflow - Entrada e Metrologia**

#### **Configura√ß√£o Inicial**
- **Usu√°rio**: T√©cnico
- **Pr√©-requisito**: Or√ßamento aprovado
- **Tela**: `/workflows` (Kanban)

#### **Passos Detalhados**

1. **Acessar Kanban de Workflows**
   ```
   ‚úì Menu > "Workflows"
   ‚úì Board Kanban carregado
   ‚úì Colunas = status (entrada, metrologia, usinagem, etc)
   ‚úì Cards = componentes de cada OS
   ```

2. **Visualizar Card de Componente**
   ```
   ‚úì Card mostra:
     - N√∫mero da OS
     - Componente (bloco, biela, etc)
     - Status atual
     - Tempo na etapa atual
     - Indicador de checklist pendente (se houver)
   ‚úì Cor do card por componente (quando filtro "Todos")
   ```

3. **Iniciar Etapa "Entrada"**
   ```
   ‚úì Clicar no card
   ‚úì Modal de detalhes abre
   ‚úì Bot√£o "Iniciar Etapa" vis√≠vel
   ‚úì Clicar em "Iniciar"
   ‚úì `started_at` deve ser setado com timestamp atual
   ‚úì Card atualiza mostrando tempo decorrido
   ```

4. **Verificar Checklist Obrigat√≥rio**
   ```
   ‚úì Se etapa tem checklist obrigat√≥rio:
     - Indicador visual no card
     - Badge "Checklist Pendente"
     - Bot√£o "Preencher Checklist" dispon√≠vel
   ```

5. **Tentar Avan√ßar Sem Checklist** üîí
   ```
   ‚úì Clicar em "Concluir Etapa"
   ‚úì Sistema deve BLOQUEAR
   ‚úì Toast de erro: "üîí Checklist Obrigat√≥rio Pendente"
   ‚úì Mensagem clara sobre qual checklist
   ‚úì Workflow N√ÉO avan√ßa
   ```

6. **Preencher Checklist Obrigat√≥rio**
   ```
   ‚úì Clicar em "Preencher Checklist"
   ‚úì Checklist espec√≠fico da etapa carrega
   ‚úì Preencher todos os campos obrigat√≥rios
   ‚úì Aprovar checklist (status = 'approved')
   ‚úì Salvar
   ```

7. **Concluir Etapa "Entrada"**
   ```
   ‚úì Ap√≥s checklist aprovado
   ‚úì Clicar em "Concluir e Avan√ßar"
   ‚úì Sistema valida checklist ‚úÖ
   ‚úì `completed_at` setado
   ‚úì Workflow avan√ßa para "Metrologia" AUTOMATICAMENTE
   ‚úì Toast: "‚úÖ Etapa avan√ßada! Workflow movido para: metrologia"
   ```

8. **Validar Avan√ßo Autom√°tico**
   ```
   ‚úì Card move para coluna "Metrologia" em tempo real
   ‚úì Status atualizado
   ‚úì `started_at` da nova etapa = NULL (n√£o iniciada ainda)
   ‚úì Timeline com eventos:
     - Conclus√£o de "Entrada"
     - Avan√ßo para "Metrologia"
   ```

9. **Etapa "Metrologia"** (Repetir fluxo)
   ```
   ‚úì Iniciar etapa
   ‚úì Preencher checklist de metrologia (medi√ß√µes)
   ‚úì Adicionar fotos das medi√ß√µes
   ‚úì Aprovar checklist
   ‚úì Concluir etapa
   ```

10. **Gera√ß√£o Autom√°tica de Relat√≥rio T√©cnico** üìÑ
    ```
    ‚úì Se etapa requer relat√≥rio (`technical_report_required = true`)
    ‚úì Ao concluir, sistema gera relat√≥rio automaticamente
    ‚úì Toast: "üìÑ Relat√≥rio T√©cnico Gerado"
    ‚úì Relat√≥rio aparece em `/ordens/:id/relatorios`
    ‚úì Inclui:
      - Dados do checklist
      - Medi√ß√µes
      - Fotos
      - Status de conformidade
    ‚úì `generated_automatically = true`
    ```

#### **Valida√ß√µes Esperadas**
- ‚úÖ Bloqueio funciona corretamente (sem checklist)
- ‚úÖ Avan√ßo autom√°tico ap√≥s conclus√£o
- ‚úÖ Tempos registrados corretamente (`started_at`, `completed_at`)
- ‚úÖ Timeline completa e cronol√≥gica
- ‚úÖ Relat√≥rio t√©cnico gerado automaticamente
- ‚úÖ Notifica√ß√µes enviadas em cada etapa
- ‚úÖ Real-time: outro usu√°rio v√™ mudan√ßas no Kanban instantaneamente

---

### **TESTE 07: Workflow - Usinagem e Montagem**

#### **Passos Resumidos**
- Seguir mesmo fluxo de TESTE 06
- Etapas: "Usinagem" ‚Üí "Montagem"
- Cada etapa pode ter checklists diferentes
- Validar bloqueios e avan√ßos autom√°ticos
- Testar cen√°rio de **Aprova√ß√£o Necess√°ria**:
  ```
  ‚úì Se transi√ß√£o requer aprova√ß√£o (`transition_type = 'approval_required'`)
  ‚úì Workflow N√ÉO avan√ßa automaticamente
  ‚úì Fica pendente de aprova√ß√£o de supervisor
  ‚úì Notifica√ß√£o enviada para supervisor
  ```

---

### **TESTE 08: Finaliza√ß√£o e Entrega**

#### **Configura√ß√£o Inicial**
- **Pr√©-requisito**: Todas as etapas anteriores conclu√≠das
- **Status atual**: "Pronto" ou "Garantia"

#### **Passos Detalhados**

1. **Concluir √öltima Etapa do Workflow**
   ```
   ‚úì Etapa "Montagem" ou "Garantia"
   ‚úì Preencher checklist final
   ‚úì Adicionar fotos do produto final
   ‚úì Concluir etapa
   ‚úì Status da OS: "aprovada" ‚Üí "em_producao" ‚Üí "concluida"
   ```

2. **Registrar Entrega**
   ```
   ‚úì Acessar detalhes da OS
   ‚úì Bot√£o "Registrar Entrega"
   ‚úì Confirmar dados:
     - Data/hora de entrega
     - Quem recebeu
     - Observa√ß√µes
   ‚úì Confirmar
   ```

3. **Gera√ß√£o Autom√°tica de Garantia** üõ°Ô∏è
   ```
   ‚úì Ao mudar status para "entregue"
   ‚úì Trigger `trg_order_delivered_warranty` dispara
   ‚úì Registro em `order_warranties`:
     - warranty_type: "total"
     - start_date: data de entrega
     - end_date: start_date + warranty_months (ex: 3 meses)
     - is_active: true
   ‚úì Notifica√ß√£o criada
   ```

4. **Validar Aba "Garantia"**
   ```
   ‚úì Acessar aba "Garantias" na OS
   ‚úì Garantia listada
   ‚úì Informa√ß√µes exibidas:
     - Tipo: Total
     - In√≠cio: DD/MM/YYYY
     - Fim: DD/MM/YYYY
     - Dias restantes
     - Status: Ativa/Expirando/Expirada
   ```

5. **Timeline Completa**
   ```
   ‚úì Todos os eventos registrados:
     - Cria√ß√£o da OS
     - Check-in t√©cnico
     - Diagn√≥sticos
     - Or√ßamento gerado
     - Aprova√ß√£o
     - Reservas de pe√ßas
     - Cada etapa de workflow
     - Relat√≥rios t√©cnicos
     - Entrega
     - Garantia criada
   ‚úì Ordem cronol√≥gica correta
   ‚úì √çcones e cores apropriados
   ```

#### **Valida√ß√µes Esperadas**
- ‚úÖ Status final: "entregue"
- ‚úÖ `actual_delivery` preenchido
- ‚úÖ Garantia criada automaticamente
- ‚úÖ Timeline completa
- ‚úÖ Notifica√ß√£o de conclus√£o
- ‚úÖ Cliente pode avaliar servi√ßo (se sistema implementado)

---

### **TESTE 09: Dashboard de Alertas**

#### **Objetivo**: Validar central de alertas e notifica√ß√µes

#### **Passos Detalhados**

1. **Acessar Dashboard de Alertas**
   ```
   ‚úì Menu > "Alertas" ou rota `/alertas`
   ‚úì Dashboard carrega com cards resumidos
   ```

2. **Validar Cards de Resumo**
   ```
   ‚úì Card "Alertas de Estoque"
     - Contagem total
     - Contagem de cr√≠ticos
     - Clicar deve filtrar/navegar
   
   ‚úì Card "Or√ßamentos Pendentes"
     - Contagem total
     - Idade do mais antigo
     - A√ß√£o r√°pida para aprovar
   
   ‚úì Card "Necessidades de Compra"
     - Contagem total
     - Urgentes em destaque
     - Link para m√≥dulo de compras
   
   ‚úì Card "Workflows Pendentes"
     - Workflows com checklist bloqueado
     - A√ß√£o r√°pida para preencher
   ```

3. **Detalhes de Alertas de Estoque**
   ```
   ‚úì Lista de alertas
   ‚úì Cada alerta com:
     - N√≠vel de severidade (cor)
     - Nome da pe√ßa
     - Estoque atual vs m√≠nimo
     - Data do alerta
     - A√ß√£o: "Ver Estoque"
   ‚úì Filtros: Por n√≠vel, por data
   ‚úì Ordena√ß√£o: Por prioridade
   ```

4. **Reconhecer Alerta**
   ```
   ‚úì Bot√£o "Reconhecer" em cada alerta
   ‚úì Ao clicar:
     - `acknowledged_at` setado
     - `acknowledged_by` = user_id
     - Cor/visual muda
     - N√£o some da lista (mas muda apar√™ncia)
   ```

5. **Resolver Alerta**
   ```
   ‚úì Para alertas de estoque:
     - Ir para m√≥dulo de compras
     - Criar pedido de compra
     - Ao receber pe√ßas: alerta desaparece automaticamente
   ```

6. **Real-time Updates**
   ```
   ‚úì Abrir dashboard em 2 navegadores
   ‚úì Browser 1: Aprovar or√ßamento que gera alerta
   ‚úì Browser 2: Dashboard deve atualizar automaticamente
   ‚úì Notifica√ß√£o toast deve aparecer
   ```

---

### **TESTE 10: Sistema de Notifica√ß√µes**

#### **Objetivo**: Validar notifica√ß√µes em tempo real

#### **Passos Detalhados**

1. **Acessar Painel de Notifica√ß√µes**
   ```
   ‚úì √çcone de sino (üîî) no header
   ‚úì Badge com contagem de n√£o lidas
   ‚úì Clicar abre sheet lateral
   ```

2. **Visualizar Notifica√ß√µes**
   ```
   ‚úì Lista de notifica√ß√µes (mais recentes no topo)
   ‚úì Cada notifica√ß√£o com:
     - √çcone/emoji
     - T√≠tulo
     - Mensagem
     - Data/hora
     - Indicador de lida/n√£o lida
     - Bot√µes de a√ß√£o
   ```

3. **Interagir com Notifica√ß√£o**
   ```
   ‚úì Clicar na notifica√ß√£o
   ‚úì Marca como lida automaticamente
   ‚úì Navega para `action_url` (se definido)
   ‚úì Sheet fecha
   ```

4. **Marcar Como Lida**
   ```
   ‚úì Bot√£o "‚úì" em cada notifica√ß√£o
   ‚úì Marca individual
   ‚úì Badge de n√£o lidas diminui
   ```

5. **Marcar Todas Como Lidas**
   ```
   ‚úì Bot√£o "Marcar todas como lidas"
   ‚úì Confirma√ß√£o visual
   ‚úì Toast de sucesso
   ‚úì Badge vai para 0
   ```

6. **Deletar Notifica√ß√£o**
   ```
   ‚úì Bot√£o "üóëÔ∏è" em cada notifica√ß√£o
   ‚úì Remove da lista
   ‚úì N√£o aparece mais
   ```

7. **Tipos de Notifica√ß√µes a Validar**
   ```
   ‚úÖ Nova OS criada
   ‚úÖ Diagn√≥stico conclu√≠do
   ‚úÖ Or√ßamento gerado
   ‚úÖ Or√ßamento aprovado
   ‚úÖ Estoque baixo
   ‚úÖ Necessidade de compra urgente
   ‚úÖ Workflow bloqueado por checklist
   ‚úÖ Relat√≥rio t√©cnico gerado
   ‚úÖ OS pronta para entrega
   ‚úÖ Garantia expirando
   ```

8. **Notifica√ß√µes Globais vs Espec√≠ficas**
   ```
   ‚úì Notifica√ß√µes globais (`is_global = true`)
     - Vis√≠veis para todos da organiza√ß√£o com permiss√£o
     - Ex: "Estoque de Pist√µes est√° cr√≠tico"
   
   ‚úì Notifica√ß√µes espec√≠ficas (`user_id != null`)
     - Apenas para usu√°rio espec√≠fico
     - Ex: "Sua OS #1234 foi aprovada"
   ```

---

## ‚úÖ Valida√ß√µes Cr√≠ticas

### **Seguran√ßa**
- [ ] RLS (Row Level Security) funcionando
- [ ] Usu√°rio s√≥ v√™ dados da sua organiza√ß√£o
- [ ] Permiss√µes de perfil respeitadas
- [ ] Fun√ß√µes `SECURITY DEFINER` s√≥ acess√≠veis via RPC

### **Performance**
- [ ] Queries com EXPLAIN ANALYZE < 100ms
- [ ] √çndices criados em colunas filtradas
- [ ] Real-time n√£o causa lag na UI
- [ ] Imagens carregam com lazy loading

### **Integridade de Dados**
- [ ] Foreign keys funcionando
- [ ] Cascades configurados corretamente
- [ ] Triggers n√£o causam loops infinitos
- [ ] Transactions rollback em caso de erro

### **UX/UI**
- [ ] Loading states em todas as a√ß√µes
- [ ] Toasts informativos
- [ ] Erros com mensagens claras
- [ ] Responsivo em mobile/tablet/desktop

---

## üìã Checklist de Testes Completo

### **M√≥dulo: Ordens de Servi√ßo**
- [ ] TESTE 01: Criar OS
- [ ] TESTE 02: Check-in T√©cnico
- [ ] Editar OS
- [ ] Cancelar OS
- [ ] Filtros e busca
- [ ] Exportar lista

### **M√≥dulo: Diagn√≥sticos**
- [ ] TESTE 03: Preencher checklist
- [ ] Aprovar diagn√≥stico
- [ ] Reprovar diagn√≥stico
- [ ] Editar diagn√≥stico existente

### **M√≥dulo: Or√ßamentos**
- [ ] TESTE 04: Gerar or√ßamento
- [ ] TESTE 05: Aprovar or√ßamento
- [ ] Reprovar or√ßamento
- [ ] Editar or√ßamento draft
- [ ] Enviar or√ßamento por e-mail
- [ ] Gerar PDF

### **M√≥dulo: Workflows**
- [ ] TESTE 06: Entrada e Metrologia
- [ ] TESTE 07: Usinagem e Montagem
- [ ] Bloqueio por checklist ‚úÖ
- [ ] Avan√ßo autom√°tico ‚úÖ
- [ ] Aprova√ß√£o manual
- [ ] Filtros no Kanban (por componente, status)
- [ ] Filtro "Todos" mant√©m cores

### **M√≥dulo: Estoque**
- [ ] Consultar estoque
- [ ] Reservar pe√ßas (manual)
- [ ] Reserva autom√°tica (via or√ßamento aprovado) ‚úÖ
- [ ] Alertas de estoque baixo ‚úÖ
- [ ] Entrada de pe√ßas (compra)
- [ ] Sa√≠da de pe√ßas (aplica√ß√£o)
- [ ] Hist√≥rico de movimenta√ß√µes

### **M√≥dulo: Compras**
- [ ] Necessidades de compra geradas automaticamente ‚úÖ
- [ ] Criar pedido de compra
- [ ] Aprovar pedido
- [ ] Receber pe√ßas
- [ ] Integra√ß√£o com fornecedores

### **M√≥dulo: Financeiro**
- [ ] Contas a receber geradas automaticamente ‚úÖ
- [ ] Registrar pagamento
- [ ] Parcelamento
- [ ] Relat√≥rios financeiros

### **M√≥dulo: Relat√≥rios**
- [ ] Relat√≥rio t√©cnico gerado automaticamente ‚úÖ
- [ ] Visualizar relat√≥rio
- [ ] Exportar PDF
- [ ] Imprimir

### **M√≥dulo: Garantias**
- [ ] TESTE 08: Garantia criada automaticamente ‚úÖ
- [ ] Registrar acionamento de garantia
- [ ] Garantias expirando (alertas)

### **M√≥dulo: Alertas e Notifica√ß√µes**
- [ ] TESTE 09: Dashboard de alertas
- [ ] TESTE 10: Sistema de notifica√ß√µes
- [ ] Real-time updates ‚úÖ
- [ ] Reconhecer/Descartar alertas

---

## üêõ Registro de Bugs e Issues

### **Template de Bug**
```markdown
### [BUG] T√≠tulo do bug

**Descri√ß√£o**: 
Breve descri√ß√£o do problema

**Passos para Reproduzir**:
1. Passo 1
2. Passo 2
3. ...

**Resultado Esperado**:
O que deveria acontecer

**Resultado Atual**:
O que est√° acontecendo

**Evid√™ncias**:
- Screenshots
- Logs do console
- Mensagens de erro

**Ambiente**:
- Browser: Chrome 120
- OS: Windows 11
- Vers√£o do app: v1.0.0

**Severidade**: üî¥ Cr√≠tico | üü° Moderado | üü¢ Baixo

**Prioridade**: Alta | M√©dia | Baixa
```

---

## ‚úÖ Conclus√£o

Este guia cobre **todos os fluxos cr√≠ticos** do sistema. 

**Priorize testar**:
1. ‚úÖ TESTE 05 (Aprova√ß√£o com triggers)
2. ‚úÖ TESTE 06 (Bloqueio por checklist)
3. ‚úÖ TESTE 08 (Garantia autom√°tica)
4. ‚úÖ TESTE 09 e 10 (Alertas e notifica√ß√µes)

**Ap√≥s completar todos os testes**, o sistema est√° pronto para:
- [ ] Homologa√ß√£o com usu√°rios
- [ ] Deploy em produ√ß√£o
- [ ] Treinamento da equipe

---

**√öltima atualiza√ß√£o**: Outubro/2025  
**Vers√£o**: 1.0  
**Autor**: Equipe de Desenvolvimento

